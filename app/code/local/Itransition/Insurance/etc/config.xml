<?xml version="1.0" encoding="utf-8"?>
<config>
    <modules>
        <Itransition_Insurance>
            <version>1.0.0</version>
        </Itransition_Insurance>
    </modules>
    <frontend>
        <layout>
            <updates>
                <itransition_layout>
                    <file>itransition_insurance.xml</file>
                </itransition_layout>
            </updates>
        </layout>
    </frontend>
    <global>
        <models>
            <insurance>
                <class>Itransition_Insurance_Model</class>
            </insurance>
        </models>
        <blocks>
            <checkout>
                <rewrite>
                    <onepage_shipping_method_additional>Itransition_Insurance_Checkout_Block_Onepage_Shipping_Method_Additional</onepage_shipping_method_additional>
                </rewrite>
            </checkout>
            <sales>
                <rewrite>
                    <order_totals>Itransition_Insurance_Sales_Block_Order_Totals</order_totals>
                    <order_invoice_totals>Itransition_Insurance_Sales_Block_Order_Invoice_Totals</order_invoice_totals>
                    <order_creditmemo_totals>Itransition_Insurance_Sales_Block_Order_Creditmemo_Totals</order_creditmemo_totals>
                </rewrite>
            </sales>
            <adminhtml>
                <rewrite>
                    <sales_order_totals>Itransition_Insurance_Sales_Block_Order_Totals</sales_order_totals>
                    <sales_order_invoice_totals>Itransition_Insurance_Sales_Block_Order_Invoice_Totals</sales_order_invoice_totals>
                    <sales_order_creditmemo_totals>Itransition_Insurance_Sales_Block_Order_Creditmemo_Totals</sales_order_creditmemo_totals>
                </rewrite>
            </adminhtml>
        </blocks>
        <helpers>
            <itransition_insurance>
                <class>Itransition_Insurance_Helper</class>
            </itransition_insurance>
        </helpers>
        <sales>
            <quote>
                <totals>
                    <insurance>
                        <class>itransition_insurance_model_total_quote</class>
                        <after>subtotal</after>
                    </insurance>
                </totals>
            </quote>
            <order_invoice>
                <totals>
                    <insurance>
                        <class>itransition_insurance_model_total_invoice</class>
                        <after>subtotal</after>
                    </insurance>
                </totals>
            </order_invoice>
            <order_creditmemo>
                <totals>
                    <insurance>
                        <class>itransition_insurance_model_total_creditmemo</class>
                        <after>subtotal</after>
                    </insurance>
                </totals>
            </order_creditmemo>
        </sales>
        <events>
            <adminhtml_init_system_config>
                <observers>
                    <insurance_init_system_config>
                        <class>itransition_insurance_model_observer_insurance</class>
                        <method>extendCarrierConfig</method>
                    </insurance_init_system_config>
                </observers>
            </adminhtml_init_system_config>
            <checkout_controller_onepage_save_shipping_method>
                <observers>
                    <insurance_init_system_config>
                        <class>itransition_insurance_model_observer_insurance</class>
                        <method>addInsurance</method>
                    </insurance_init_system_config>
                </observers>
            </checkout_controller_onepage_save_shipping_method>
        </events>
        <resources>
            <itransition_insurance_setup>
                <setup>
                    <module>Itransition_Insurance</module>
                </setup>
            </itransition_insurance_setup>
        </resources>
        <fieldsets>
            <sales_convert_quote_address>
                <is_include_insurance>
                    <to_order_address>*</to_order_address>
                </is_include_insurance>
                <insurance_amount>
                    <to_order_address>*</to_order_address>
                </insurance_amount>
            </sales_convert_quote_address>
        </fieldsets>
    </global>
    <default>
        <shipping>
            <option>
                <checkout_multiple>1</checkout_multiple>
                <checkout_multiple_maximum_qty>100</checkout_multiple_maximum_qty>
                <shipping_includes_insurance>1</shipping_includes_insurance>
            </option>
            <origin>
                <country_id>US</country_id>
                <postcode>90034</postcode>
                <region_id>12</region_id>
            </origin>
        </shipping>
    </default>
    <insurance>
        <!--Поля для расширения способа доставки-->
        <carrier>
            <fields>
                <include_insurance translate="label">
                    <label>Include insurance</label>
                    <frontend_type>select</frontend_type>
                    <source_model>adminhtml/system_config_source_yesno</source_model>
                    <sort_order>5000</sort_order>
                    <show_in_default>1</show_in_default>
                    <show_in_website>1</show_in_website>
                    <show_in_store>1</show_in_store>
                </include_insurance>
                <insurance_type translate="label">
                    <label>Insurance type</label>
                    <frontend_type>select</frontend_type>
                    <source_model>Itransition_Insurance_Model_Insurance</source_model>
                    <sort_order>5001</sort_order>
                    <show_in_default>1</show_in_default>
                    <show_in_website>1</show_in_website>
                    <show_in_store>1</show_in_store>
                    <depends>
                        <include_insurance>1</include_insurance>
                    </depends>
                </insurance_type>
                <insurance_value translate="label">
                    <label>Insurance value</label>
                    <frontend_type>text</frontend_type>
                    <validate>validate-number required-entry validate-greater-than-zero</validate>
                    <sort_order>5002</sort_order>
                    <show_in_default>1</show_in_default>
                    <show_in_website>1</show_in_website>
                    <show_in_store>1</show_in_store>
                    <depends>
                        <include_insurance>1</include_insurance>
                    </depends>
                </insurance_value>
            </fields>
        </carrier>
    </insurance>
</config>
